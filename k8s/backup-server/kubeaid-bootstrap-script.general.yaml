forkURLs:
  # KubeAid repository URL (in HTTPs syntax).
  # Defaults to Obmondo's KubeAid repository.
  kubeaid: https://github.com/Obmondo/KubeAid

  # Your KubeAid config repository URL (in HTTPs syntax).
  kubeaidConfig: https://github.com/asifulhaque786/kubeaid-config

cluster:

  # Kubernetes cluster name.
  name: backup-server

  # Kubernetes version to use.
  #
  # We're using Kubermatic KubeOne v1.10 under the hood, to initialize the Kubernete cluster.
  # And the supported Kubernetes versions are specified here :
  # https://docs.kubermatic.com/kubeone/v1.10/architecture/compatibility/supported-versions/.
  k8sVersion: v1.34.2

  # Kubeaid version to use.
  #
  # By default, the latest KubeAid version is used.
  # You can view all the KubeAid versions here : https://github.com/Obmondo/kubeaid/releases.
  kubeaidVersion: 20.1.1

  # Kubernetes API server specific configurations.
  # REFER : https://github.com/kubernetes-sigs/cluster-api/blob/main/controlplane/kubeadm/config/crd/bases/controlplane.cluster.x-k8s.io_kubeadmcontrolplanes.yaml.
  #
  # NOTE : Generally, refer to the KubeadmControlPlane CRD instead of the corresponding GoLang
  #        source types linked below.
  #        There are some configuration options which appear in the corresponding GoLang source type,
  #        but not in the CRD. If you set those fields, then they get removed by the Kubeadm
  #        control-plane provider. This causes the capi-cluster ArgoCD App to always be in an
  #        OutOfSync state, resulting to the KubeAid Bootstrap Script not making any progress!
  # apiServer:
  #
  #   extraArgs: {}
  #
  #   # REFER : "sigs.k8s.io/cluster-api/bootstrap/kubeadm/api/v1beta1".HostPathMount
  #   #
  #   # NOTE : If you want a mount to be read-only, then set extraVolume.readOnly to true.
  #   #        Otherwise, omit setting that field. It gets removed by the Kubeadm control-plane
  #   #        provider component, which results to the capi-cluster ArgoCD App always being in
  #   #        OutOfSync state.
  #   extraVolumes: []
  #
  #   # REFER : "sigs.k8s.io/cluster-api/bootstrap/kubeadm/api/v1beta1".File
  #   files: []

  # Uncomment, if you just want audit-logging to work out of the box! KubeAid Bootstrap Script will
  # set necessary configuration options in cluster.apiServer.
  # enableAuditLogging: True

  # Any additional users you want to be setup for each Kubernetes node.
  # additionalUsers:
  #  - name: <username>
  #    sshPublicKey: xxxxxxxxxx

cloud:
  hetzner:
    mode: bare-metal

    bareMetal:
      # If true, then before provisioning each machine, ClusterAPI Provider Hetzner (CAPH) will
      # wipe the disks.
      wipeDisks: False

      # Details about the Hetzner Bare Metal SSH KeyPair, that you created to meet the
      # prerequisites.
      # This SSH key-pair will be used to SSH into the Hetzner Bare Metal servers (in both normal
      # or rescue mode).
      sshKeyPair:
        name: cluster
        publicKeyFilePath: ./outputs/ssh/rsa/openssh/.pub
        privateKeyFilePath: ./outputs/ssh/rsa/openssh/.key


      diskLayoutSetupCommands: |
        apt-get update -y
        apt install zfsutils-linux -y

        printf "d\n4\nw\n" | fdisk /dev/sdb
        printf "d\n4\nw\n" | fdisk /dev/sda

        sgdisk -n 4:0:0 -t 4:fd00 -c 4:"zpool" /dev/sda
        partprobe /dev/sda
        sgdisk -n 4:0:0 -t 4:fd00 -c 4:"zpool" /dev/sdb
        partprobe /dev/sdb
        udevadm settle

        if zpool import -f primary >/dev/null 2>&1; then
          echo "Imported existing primary ZPool"
        else
          zpool create primary mirror /dev/sda4 /dev/sdb4 mirror /dev/sdc /dev/sdd

          zfs create -s -V 100G primary/containerd
          udevadm settle
          mkfs.ext4 /dev/zvol/primary/containerd

          zfs create -s -V 50G primary/pod-ephemeral-volumes
          udevadm settle
          mkfs.ext4 /dev/zvol/primary/pod-ephemeral-volumes

          zfs create -s -V 50G primary/pod-logs
          udevadm settle
          mkfs.ext4 /dev/zvol/primary/pod-logs
        fi

        mkdir -p /var/lib/containerd
        echo "/dev/zvol/primary/containerd /var/lib/containerd ext4 defaults,nofail 0 0" \
        | tee -a /etc/fstab
        mount /var/lib/containerd

        mkdir -p /var/lib/kubelet/pods
        echo "/dev/zvol/primary/pod-ephemeral-volumes /var/lib/kubelet/pods ext4 defaults,nofail 0 0" \
        | tee -a /etc/fstab
        mount /var/lib/kubelet/pods

        mkdir -p /var/log/pods
        echo "/dev/zvol/primary/pod-logs /var/log/pods ext4 defaults,nofail 0 0" | tee -a /etc/fstab
        mount /dev/zvol/primary/pod-logs /var/log/pods

        # Enable weekly ZPool trimming for the ZPool.
        # So unused storage space will be reclaimed back, from the ZVolumes into the ZPool.
        # REFER : https://openzfs.github.io/openzfs-docs/man/master/8/zpool-trim.8.html.
        systemctl enable zfs-trim-weekly@rpool.timer --now

    controlPlane:
      # Regions you're using in the eu-central Hetzner network zone.
      #
      # NOTE : We only support the eu-central Hetzner network zone for now.
      regions:
        - fsn1
        - nbg1
        - hel1

      bareMetal:
        # Kubernetes API server endpoint.
        endpoint:
          # Endpoint host.
          #
          # If you have only 1 contol-plane node, this can be the IP of that control-plane node.
          #
          # Otherwise, to have multiple control-plane nodes, you need to use a Hetzner Bare Metal
          # Failover IP.
          host: "195.201.109.239"

          # Whether you're using a Hetzner Bare-Metal Failover IP or not.
          isFailoverIP: false

        bareMetalHosts:
          - serverID: 2845449
            wwns:
              - "0x5000c500b39edb52"
              - "0x5000c500b3a48a7f"

          # taints: []


